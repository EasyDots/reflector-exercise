<!doctype html>
<html>

<body>
    <canvas id="can" width="400" height="400" style="background:Black"></canvas>
    <script>
        const KEY_LEFT = 37,
              KEY_UP = 38,
              KEY_RIGHT = 39,
              KEY_DONW = 40;

        const BLOCK_WIDTH = 
              BLOCK_HEIGHT = 20;
        const BLOCK_UNIT_PIXEL = 20;

        let snakes = [42, 41],
            foodPos = 43,
            direction = 1,
            ctx = document.getElementById("can").getContext("2d");

        function drawItem(pos, color) {
            ctx.fillStyle = color;
            let x = pos % BLOCK_WIDTH * BLOCK_UNIT_PIXEL + 1,
                y =  ~~(pos / BLOCK_WIDTH) * BLOCK_UNIT_PIXEL + 1;
            ctx.fillRect(x,y, 18, 18);
        }

        document.onkeydown = function (e) {            
            let newDerection = -1;

            switch(e.keyCode){
                case KEY_LEFT:
                    newDerection = -1;
                    break;
                case KEY_UP:
                    newDerection = -BLOCK_WIDTH;
                    break;
                case KEY_RIGHT:
                    newDerection = 1;
                    break;
                case KEY_DONW:
                    newDerection = BLOCK_WIDTH;
                    break;
                default:
                    return;               
            }

            if(newDerection == -direction)return;
            direction = newDerection;
        };

        function isHitTheWall(){
            let head = snakes[0];

            return (head < 0) ||
                   (head > 399) ||
                   ( direction == 1 && head % BLOCK_WIDTH == 0) ||
                   (direction == -1 && head % BLOCK_WIDTH == 19) ||
                   (snakes.indexOf(head, 1) > 0);
        }

        function caculateNextPos(pos,direction){
            return pos + direction;
        }

        function moveSnake(direction){
            let head = snakes[0];
            let newHead = caculateNextPos(head,direction);
            snakes.unshift(newHead);
            return newHead;
        }

        function isInSnake(pos){
            return snakes.indexOf(pos) > 0;
        }

        function getNewRandomFoodPos(){
            while(true){
                let randPos =  Math.random() * 400;
                randPos = Math.floor(randPos);

                if(! isInSnake(randPos)){
                    return randPos;
                }
            };
        }

        function drawBackgraound(){
            for(let i =0;i<BLOCK_WIDTH * BLOCK_HEIGHT;i++){
                drawItem(i,"Black");
            }
        }

        function drawFood(){
            drawItem(foodPos,"Yellow");
        }

        function drawSnake(){
            for(let i in snakes){
                let pos =snakes[i];
                drawItem(pos,"Green");
            }
        }

        function draw(){
            drawBackgraound();
            drawFood();
            drawSnake();
        }

        function isHitPos(pos){
            return snakes[0] === pos;
        }
        

        function process() {
            moveSnake(direction);

            if (isHitTheWall()){
                return alert("GAME OVER");
            }

            if (isHitPos(foodPos)) {
                foodPos = getNewRandomFoodPos();
            } else{
                snakes.pop();
            }

            draw();           
        }
        setInterval(process, 130);
    </script>
</body>

</html>